# -*- coding: utf-8 -*-

# --- –ë–õ–û–ö 1: –ò–ú–ü–û–†–¢ –ù–ï–û–ë–•–û–î–ò–ú–´–• –ë–ò–ë–õ–ò–û–¢–ï–ö ---

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python
import xml.etree.ElementTree as ET # –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ (–ø–∞—Ä—Å–∏–Ω–≥–∞) XML-—Ñ–∞–π–ª–æ–≤.
import gzip                      # –î–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ .gz –∞—Ä—Ö–∏–≤–æ–≤, —Ç–∞–∫ –∫–∞–∫ sitemap-—Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∂–∞—Ç—ã.
from typing import List, Set, Optional # –î–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (List, Set). –î–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º.
import sys                       # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
import io                        # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
import os                        # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–∫–∏.
import json                      # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞—Ç–æ–º JSON.

# –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—Ç—Ä–µ–±—É—é—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ pip)
import requests                  # –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—ã—á–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ).
import pandas as pd              # –ú–æ—â–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è Excel-—Ñ–∞–π–ª–∞.
import undetected_chromedriver as uc # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Selenium, –∫–æ—Ç–æ—Ä–∞—è —É–º–µ–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤.
from bs4 import BeautifulSoup    # –û—á–µ–Ω—å —É–¥–æ–±–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ "–≥—Ä—è–∑–Ω–æ–≥–æ" HTML-–∫–æ–¥–∞.

# --- –ë–õ–û–ö 2: –ù–ê–°–¢–†–û–ô–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø ---

# –≠—Ç–∞ —á–∞—Å—Ç—å –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ Windows –∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã.
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

# --- –ë–õ–û–ö 3: –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –ò –ö–û–ù–°–¢–ê–ù–¢–´ ---

# –°–ª–æ–≤–∞—Ä—å —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∏ –∏—Ö –æ—Å–Ω–æ–≤–Ω—ã–º–∏ URL. –£–¥–æ–±–Ω–æ, —á—Ç–æ–±—ã –Ω–µ "–∑–∞—à–∏–≤–∞—Ç—å" —Å—Å—ã–ª–∫–∏ –ø—Ä—è–º–æ –≤ –∫–æ–¥.
PROVIDER_ROOT_URLS = {"Selectel": "https://docs.selectel.ru/", "Yandex Cloud": "https://cloud.yandex.ru/", "VK Cloud": "https://cloud.vk.com/"}
# –ü—Ä–µ—Ñ–∏–∫—Å—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º—ã –±—É–¥–µ–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ —Å—Å—ã–ª–∫–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
DOC_PREFIXES = {"Selectel": "https://docs.selectel.ru/", "Yandex Cloud": "https://yandex.cloud/ru/docs/", "VK Cloud": "https://cloud.vk.com/docs/"}
# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–µ–≥–æ–≤ –≤ XML-—Ñ–∞–π–ª–∞—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ sitemap.
XML_NAMESPACE = {'sitemap': 'http://www.sitemaps.org/schemas/sitemap/0.9'}
# –ó–∞–≥–æ–ª–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—à —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å. `User-Agent` –≥–æ–≤–æ—Ä–∏—Ç —Å–∞–π—Ç—É, —á—Ç–æ –º—ã ‚Äî –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä Chrome, –∞ –Ω–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç.
HEADERS = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36'}
# –ò–º—è –ø–∞–ø–∫–∏, –∫—É–¥–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∏—Ç–æ–≥–æ–≤—ã–µ —Ñ–∞–π–ª—ã.
OUTPUT_DIR = "analysis_results"


# --- –ë–õ–û–ö 4: –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ---

def get_all_urls_from_sitemap_requests(session, sitemap_url: str, visited: Set[str]) -> List[str]:
    """
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –Ω–∞—à–∞ '—Ä–∞–±–æ—á–∞—è –ª–æ—à–∞–¥–∫–∞'. –û–Ω–∞ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –ø–∞—Ä—Å–∏—Ç sitemap-—Ñ–∞–π–ª—ã.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è "–ø—Ä–æ—Å—Ç—ã—Ö" —Å–∞–π—Ç–æ–≤ (Selectel, VK Cloud) –∏ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ø–Ω–¥–µ–∫—Å–∞,
    –∫–æ–≥–¥–∞ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å "–∫–ª—é—á–∏" (cookies) –≤ —Å–µ—Å—Å–∏–∏.
    –§—É–Ω–∫—Ü–∏—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è: –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç sitemap, –∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ sitemap'—ã,
    –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∞–º—É —Å–µ–±—è –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π —Å—Å—ã–ª–∫–∏.
    """
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∏ –ª–∏ –º—ã —É–∂–µ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.
    if sitemap_url in visited: return []
    print(f"    - (Requests) –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é: {sitemap_url}"); visited.add(sitemap_url)

    # 2. –î–µ–ª–∞–µ–º GET-–∑–∞–ø—Ä–æ—Å —Å –ø–æ–º–æ—â—å—é —Å–µ—Å—Å–∏–∏ `requests`.
    try:
        r = session.get(sitemap_url, timeout=20); r.raise_for_status(); content = r.content
    except Exception as e:
        print(f"      ‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {e}"); return []

    # 3. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç, –≤—ã—Ö–æ–¥–∏–º.
    if not content:
        print(f"      ‚ùå –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è {sitemap_url}"); return []
        
    # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–∂–∞—Ç –ª–∏ —Ñ–∞–π–ª (–Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –æ–Ω —Å '–º–∞–≥–∏—á–µ—Å–∫–∏—Ö' –±–∞–π—Ç–æ–≤ .gz), –∏ –µ—Å–ª–∏ –¥–∞ ‚Äî —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º.
    if content.startswith(b'\x1f\x8b'): content = gzip.decompress(content)

    # 5. –ü–∞—Ä—Å–∏–º XML –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Å—ã–ª–∫–∏.
    try:
        root = ET.fromstring(content); urls = []
        # –ò—â–µ–º —Ç–µ–≥–∏ `<sitemap>`, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ sitemap-—Ñ–∞–π–ª—ã.
        if root.findall('sitemap:sitemap', XML_NAMESPACE):
            for node in root.findall('sitemap:sitemap', XML_NAMESPACE):
                if (loc := node.find('sitemap:loc', XML_NAMESPACE)) is not None:
                    # –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º ‚Äî –≤—ã–∑—ã–≤–∞–µ–º —Å–µ–±—è –∂–µ (—Ä–µ–∫—É—Ä—Å–∏—è).
                    urls.extend(get_all_urls_from_sitemap_requests(session, loc.text, visited))
        # –ï—Å–ª–∏ —ç—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π sitemap, –∏—â–µ–º —Ç–µ–≥–∏ `<url>` –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –Ω–∏—Ö —Å—Å—ã–ª–∫–∏.
        else:
            for node in root.findall('sitemap:url', XML_NAMESPACE):
                if (loc := node.find('sitemap:loc', XML_NAMESPACE)) is not None:
                    urls.append(loc.text)
        return urls
    except ET.ParseError as e:
        print(f"      ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML: {e}"); return []

def process_yandex_cloud_manual() -> List[str]:
    """
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –Ω–∞—à–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞. –û–Ω–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ '–ö—Ä–∞–∂–∞ —Å–µ—Å—Å–∏–∏',
    –∫–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–π—Ç–∏ —Å–∞–º—É—é —Å–ª–æ–∂–Ω—É—é –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É, –∞ –¥–∞–ª—å—à–µ —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    """
    print("  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è. –ò—Å–ø–æ–ª—å–∑—É—é '–ö—Ä–∞–∂—É —Å–µ—Å—Å–∏–∏'...")
    driver: Optional[uc.Chrome] = None
    content: Optional[str] = None
    try:
        # --- –≠–¢–ê–ü 1: –†–£–ß–ù–û–ô –ü–†–û–†–´–í ---
        # –°–æ–∑–¥–∞–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞. –í–∞–∂–Ω–æ, —á—Ç–æ –º—ã –ù–ï –≤–∫–ª—é—á–∞–µ–º headless-—Ä–µ–∂–∏–º.
        options = uc.ChromeOptions()
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–∏–º—ã–π –±—Ä–∞—É–∑–µ—Ä.
        driver = uc.Chrome(options=options)
        driver.set_window_size(1200, 800)
        
        # –í—ã–≤–æ–¥–∏–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∂–¥–µ–º, –ø–æ–∫–∞ –æ–Ω –Ω–∞–∂–º–µ—Ç Enter.
        print("\n" + "="*50)
        print("--- –¢–†–ï–ë–£–ï–¢–°–Ø –í–ê–®–ï –î–ï–ô–°–¢–í–ò–ï ---")
        print("1. –°–µ–π—á–∞—Å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞ Chrome.")
        print("2. –í—Ä—É—á–Ω—É—é –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –Ω–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É:")
        print("   https://yandex.cloud/sitemap_index.xml")
        print("3. –î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ XML-—Ñ–∞–π–ª–∞.")
        print("\n   –í–ê–ñ–ù–û: –ù–ï –ó–ê–ö–†–´–í–ê–ô–¢–ï –û–ö–ù–û –ë–†–ê–£–ó–ï–†–ê –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û!\n")
        input("4. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —ç—Ç—É –∫–æ–Ω—Å–æ–ª—å –∏ –Ω–∞–∂–º–∏—Ç–µ Enter...")
        print("="*50 + "\n")
        print("    - –û—Ç–ª–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–±–æ—Ç—É...")

        # --- –≠–¢–ê–ü 2: "–ö–†–ê–ñ–ê –°–ï–°–°–ò–ò" –ò –ò–ó–í–õ–ï–ß–ï–ù–ò–ï XML ---
        # –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Enter, –º—ã "–∫—Ä–∞–¥–µ–º" —É –±—Ä–∞—É–∑–µ—Ä–∞ cookies.
        cookies = driver.get_cookies()
        print("    - Cookies —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω—ã –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.")

        # *** –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø ‚Ññ3: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ XML —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. ***
        # –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.
        print("    - –ü—ã—Ç–∞—é—Å—å –∏–∑–≤–ª–µ—á—å XML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")

        # –ú–µ—Ç–æ–¥ 1: –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π. –ú—ã –ø—Ä–æ—Å–∏–º –±—Ä–∞—É–∑–µ—Ä –≤—ã–ø–æ–ª–Ω–∏—Ç—å JavaScript-–∫–æ–¥
        # –∏ –≤–µ—Ä–Ω—É—Ç—å –í–ï–°–¨ –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –î–ª—è XML-—Ñ–∞–π–ª–∞ —ç—Ç–æ –∏ –µ—Å—Ç—å —Å–∞–º XML.
        # –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –º–µ–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–µ—Ä—Å—Ç–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
        print("      -> –ú–µ—Ç–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JavaScript –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.")
        content = driver.execute_script("return document.body.innerText")

        # –ï—Å–ª–∏ –ú–µ—Ç–æ–¥ 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª (–≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É) –∏–ª–∏ –≤–µ—Ä–Ω—É–ª –Ω–µ XML,
        # –ø—Ä–æ–±—É–µ–º –ú–µ—Ç–æ–¥ 2 –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π.
        if not content or not content.strip().startswith('<?xml'):
            print("      -> –ú–µ—Ç–æ–¥ 1 –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–ª–∏ –≤–µ—Ä–Ω—É–ª –Ω–µ XML. –ü—Ä–æ–±—É—é –ú–µ—Ç–æ–¥ 2.")
            
            # –ú–µ—Ç–æ–¥ 2: –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥. –û–Ω –∏—â–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ–≥ <div>, –≤ –∫–æ—Ç–æ—Ä—ã–π Chrome "–∑–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç" XML.
            # –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –±–æ–ª–µ–µ —Ö—Ä—É–ø–∫–∏–π, —Ç–∞–∫ –∫–∞–∫ ID —Ç–µ–≥–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö Chrome.
            print("      -> –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ HTML-–∫–æ–¥–µ.")
            page_source = driver.page_source
            soup = BeautifulSoup(page_source, 'html.parser')
            xml_container = soup.find('div', {'id': 'webkit-xml-viewer-source-xml'})
            if xml_container:
                content = xml_container.decode_contents()

        # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø–æ—Å–ª–µ –¥–≤—É—Ö –º–µ—Ç–æ–¥–æ–≤ —É –Ω–∞—Å –≤—Å–µ –µ—â–µ –Ω–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞,
        # –∑–Ω–∞—á–∏—Ç, –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ—Ä—å–µ–∑–Ω–∞—è –æ—à–∏–±–∫–∞, –∏ –º—ã –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
        if not content:
            # –ú—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –µ–≥–æ –ø–æ–π–º–∞–ª –Ω–∞—à –±–ª–æ–∫ `except` –Ω–∏–∂–µ,
            # –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫—Ä–∞—Å–∏–≤–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
            raise ValueError("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å XML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∏ –æ–¥–Ω–∏–º –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤.")
        
        print("    - ‚úÖ XML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ.")

    except Exception as e:
        # –≠—Ç–æ—Ç –±–ª–æ–∫ –ª–æ–≤–∏—Ç –õ–Æ–ë–´–ï –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –Ω–∞ —ç—Ç–∞–ø–µ Selenium,
        # –≤–∫–ª—é—á–∞—è –Ω–∞—à—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É `ValueError`.
        print("\n      ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å XML –∏–∑ HTML-–∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.")
        print("      üí° –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: –í–µ—Ä—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ Chrome –æ–±–Ω–æ–≤–∏–ª–∞—Å—å, –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è XML –∏–∑–º–µ–Ω–∏–ª—Å—è.")
        print("      üí° –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: –û—Ç–∫—Ä–æ–π—Ç–µ XML-—Ñ–∞–π–ª –≤ Chrome –≤—Ä—É—á–Ω—É—é, –Ω–∞–∂–º–∏—Ç–µ '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥' –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω HTML.")
        print(f"      - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª—å –æ—à–∏–±–∫–∏: {e}")
        return [] # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –º–æ–≥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏.
    finally:
        # –ö—Ä–∞–π–Ω–µ –≤–∞–∂–Ω—ã–π –±–ª–æ–∫! –û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.
        if driver:
            driver.quit()
            print("    - –ë—Ä–∞—É–∑–µ—Ä Selenium –∑–∞–∫—Ä—ã—Ç. –û–Ω –Ω–∞–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω.")

    # --- –≠–¢–ê–ü 3: –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê (–° –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï–ú –ü–û–õ–£–ß–ï–ù–ù–´–• –î–ê–ù–ù–´–•) ---
    # –°–æ–∑–¥–∞–µ–º –±—ã—Å—Ç—Ä—É—é –∏ —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é `requests`.
    session = requests.Session()
    # "–í–æ–æ—Ä—É–∂–∞–µ–º" –µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.
    session.headers.update(HEADERS)
    # –ü–µ—Ä–µ–¥–∞–µ–º —É–∫—Ä–∞–¥–µ–Ω–Ω—ã–µ cookies –≤ –Ω–∞—à—É —Å–µ—Å—Å–∏—é. –¢–µ–ø–µ—Ä—å —ç—Ç–∞ —Å–µ—Å—Å–∏—è –¥–ª—è —Å–∞–π—Ç–∞ –Ø–Ω–¥–µ–∫—Å–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ "—Å–≤–æ—è".
    for cookie in cookies:
        session.cookies.set(cookie['name'], cookie['value'], domain=cookie['domain'])
    print("    - –°–µ—Å—Å–∏—è Requests –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞—á–∏–Ω–∞—é –±—ã—Å—Ç—Ä—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É.")
    
    # –ü–∞—Ä—Å–∏–º —É–∂–µ —á–∏—Å—Ç—ã–π XML –∏ –¥–∞–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à—É –±—ã—Å—Ç—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é `get_all_urls_from_sitemap_requests`
    # —Å —É–∂–µ "–∑–∞—Ä—è–∂–µ–Ω–Ω–æ–π" –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–µ–π.
    root = ET.fromstring(content)
    total_urls = []
    visited_sitemaps = set()
    sitemap_nodes = root.findall('sitemap:sitemap', XML_NAMESPACE)
    for node in sitemap_nodes:
        if (loc := node.find('sitemap:loc', XML_NAMESPACE)) is not None:
            total_urls.extend(get_all_urls_from_sitemap_requests(session, loc.text, visited_sitemaps))
    return total_urls

# --- –ë–õ–û–ö 5: –û–°–ù–û–í–ù–û–ô –ö–û–î –°–ö–†–ò–ü–¢–ê ---

# –≠—Ç–æ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.
if __name__ == "__main__":
    # –í—ã–≤–æ–¥–∏–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    print("üöÄ –ó–∞–ø—É—Å–∫–∞—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ sitemap-—Ñ–∞–π–ª–æ–≤...\n")

    # –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ–º —Å–æ–±–∏—Ä–∞—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞.
    all_data_for_excel = [] # –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –¥–ª—è Excel.
    all_data_for_json = {}  # –°–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–ª—é—á - –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∑–Ω–∞—á–µ–Ω–∏–µ - —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫.

    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É –∏–∑ –Ω–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.
    for provider, root_url in PROVIDER_ROOT_URLS.items():
        print(f"--- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: {provider} ---")
        
        # –ï—Å–ª–∏ —ç—Ç–æ –Ø–Ω–¥–µ–∫—Å, –≤—ã–∑—ã–≤–∞–µ–º –Ω–∞—à—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é '–≥–∏–±—Ä–∏–¥–Ω—É—é' —Ñ—É–Ω–∫—Ü–∏—é.
        if provider == "Yandex Cloud":
            total_urls = process_yandex_cloud_manual()
        # –î–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –ø—Ä–æ—Å—Ç–æ–π –º–µ—Ç–æ–¥.
        else:
            print("  - –ò—Å–ø–æ–ª—å–∑—É—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º Requests.")
            session = requests.Session(); session.headers.update(HEADERS)
            try:
                # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ sitemap –≤ —Ñ–∞–π–ª–µ robots.txt - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±.
                r = requests.get(f"{root_url.rstrip('/')}/robots.txt", timeout=10)
                sitemap_entries = [line.split(': ')[1] for line in r.text.splitlines() if line.lower().startswith('sitemap:')]
                # –ï—Å–ª–∏ –≤ robots.txt –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π sitemap.xml.
                if not sitemap_entries: sitemap_entries.append(f"{root_url.rstrip('/')}/sitemap.xml")
            except Exception:
                # –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–º—è.
                sitemap_entries = [f"{root_url.rstrip('/')}/sitemap.xml"]
                
            total_urls = []
            visited_sitemaps = set()
            for entry in sitemap_entries:
                total_urls.extend(get_all_urls_from_sitemap_requests(session, entry, visited_sitemaps))
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
        doc_prefix = DOC_PREFIXES[provider]
        doc_urls = sorted(list(set([url for url in total_urls if url.startswith(doc_prefix)])))
        
        # –ù–∞–ø–æ–ª–Ω—è–µ–º –Ω–∞—à–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—É–¥—É—â–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞.
        all_data_for_json[provider] = doc_urls
        for url in doc_urls:
            all_data_for_excel.append({'provider': provider, 'url': url})

        # –í—ã–≤–æ–¥–∏–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É.
        print(f"\n‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ {len(doc_urls)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ '{doc_prefix}'.")
        if doc_urls:
            print("  –ü—Ä–∏–º–µ—Ä—ã —Å—Å—ã–ª–æ–∫:"); [print(f"    - {url}") for url in doc_urls[:3]]
        print("-" * 25)

    # --- –ë–õ–û–ö 6: –≠–ö–°–ü–û–†–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ---
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å.
    if all_data_for_excel:
        print("\nüíæ –°–æ—Ö—Ä–∞–Ω—è—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª—ã...")
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
        # `exist_ok=True` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø–∞–ø–∫–∞ —É–∂–µ –µ—Å—Ç—å.
        os.makedirs(OUTPUT_DIR, exist_ok=True)

        # 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ JSON.
        json_path = os.path.join(OUTPUT_DIR, 'task3_documentation_urls.json')
        try:
            with open(json_path, 'w', encoding='utf-8') as f:
                # `indent=4` –¥–µ–ª–∞–µ—Ç —Ñ–∞–π–ª –∫—Ä–∞—Å–∏–≤—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º.
                # `ensure_ascii=False` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã.
                json.dump(all_data_for_json, f, indent=4, ensure_ascii=False)
            print(f"  - ‚úÖ JSON-—Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {json_path}")
        except Exception as e:
            print(f"  - ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON-—Ñ–∞–π–ª: {e}")

        # 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Excel.
        excel_path = os.path.join(OUTPUT_DIR, 'task3_documentation_urls.xlsx')
        try:
            # –°–æ–∑–¥–∞–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π DataFrame (—Ç–∞–±–ª–∏—Ü—É pandas).
            df = pd.DataFrame(all_data_for_excel)
            # –û–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `to_excel` —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ —Ñ–∞–π–ª.
            # `index=False` —É–±–∏—Ä–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—É—é –∫–æ–ª–æ–Ω–∫—É —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ —Å—Ç—Ä–æ–∫.
            df.to_excel(excel_path, index=False)
            print(f"  - ‚úÖ Excel-—Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {excel_path}")
        except Exception as e:
            print(f"  - ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å Excel-—Ñ–∞–π–ª: {e}")

    # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    print("\nüéâ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.")